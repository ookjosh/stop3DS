<!DOCTYPE html>
<html>
  <head>
    <title>Stop3DS</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.26" />

<title>Application State :: Stop3DS</title>
<link rel="shortcut icon" href="/stop3DS/images/favicon.png" type="image/x-icon" />
<link href="/stop3DS/css/nucleus.css" rel="stylesheet">
<link href="/stop3DS/css/font-awesome.min.css" rel="stylesheet">
<link href="/stop3DS/css/hybrid.css" rel="stylesheet">
<link href="/stop3DS/css/featherlight.min.css" rel="stylesheet">
<link href="/stop3DS/css/auto-complete.css" rel="stylesheet">
<link href="/stop3DS/theme-original/style.css" rel="stylesheet">

<link rel="stylesheet" href="/stop3DS/css/bootstrap.min.css">
<script src="/stop3DS/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<meta name="description" content="">


    
  </head>
  <body data-url="/stop3DS/discussions/applicationstate/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="showVisitedLinks">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <p>Stop3DS Docs</p>

  

    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/stop3DS/js/lunr.min.js"></script>
		<script type="text/javascript" src="/stop3DS/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/ookjosh.github.io\/stop3DS\/";
        
		</script>
		<script type="text/javascript" src="/stop3DS/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/stop3DS/" class="dd-item">
            <a href="/stop3DS/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/stop3DS/discussions/" class="dd-item parent">
      <a href="/stop3DS/discussions/">
        <span>Discussions</span>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/stop3DS/discussions/advancedfeatures/" class="dd-item">
        <a href="/stop3DS/discussions/advancedfeatures/">
          <span>Advanced Features</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/discussions/applicationstate/" class="dd-item active">
        <a href="/stop3DS/discussions/applicationstate/">
          <span>Application State</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/discussions/datastructure/" class="dd-item">
        <a href="/stop3DS/discussions/datastructure/">
          <span>Data Structures</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/discussions/portablecode/" class="dd-item">
        <a href="/stop3DS/discussions/portablecode/">
          <span>Portable Code</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/discussions/ui/" class="dd-item">
        <a href="/stop3DS/discussions/ui/">
          <span>UI</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/discussions/ux/" class="dd-item">
        <a href="/stop3DS/discussions/ux/">
          <span>UX</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/stop3DS/features/" class="dd-item">
      <a href="/stop3DS/features/">
        <span>Feature Tracking</span><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/stop3DS/features/gallery/" class="dd-item">
        <a href="/stop3DS/features/gallery/">
          <span>Animation Gallery</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/drawing/" class="dd-item">
        <a href="/stop3DS/features/drawing/">
          <span>Drawing</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/framecompression/" class="dd-item">
        <a href="/stop3DS/features/framecompression/">
          <span>Frame Compression</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/framerate/" class="dd-item">
        <a href="/stop3DS/features/framerate/">
          <span>Framerate</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/saveloadanimation/" class="dd-item">
        <a href="/stop3DS/features/saveloadanimation/">
          <span>Import/Export</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/onionskin/" class="dd-item">
        <a href="/stop3DS/features/onionskin/">
          <span>Onion Skinning</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/scrubbing/" class="dd-item">
        <a href="/stop3DS/features/scrubbing/">
          <span>Scrubbing</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/assets/" class="dd-item">
        <a href="/stop3DS/features/assets/">
          <span>Shared Assets</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/undoredo/" class="dd-item">
        <a href="/stop3DS/features/undoredo/">
          <span>Undo/Redo</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/stop3DS/features/internet/" class="dd-item">
        <a href="/stop3DS/features/internet/">
          <span>Web Features</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/stop3DS/snippets/" class="dd-item">
      <a href="/stop3DS/snippets/">
        <span>Snippets</span><i class="fa fa-circle-thin read-icon"></i>
      </a>
    </li>
    <li data-nav-id="/stop3DS/media/" class="dd-item">
      <a href="/stop3DS/media/">
        <span>Media</span><i class="fa fa-circle-thin read-icon"></i>
      </a>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/ookjosh/stop3DS" target="_blank" rel="noopener"><i class='fa fa-github'></i> Github repo</a></li>
                <li class="" role=""><a href="/stop3DS/showcase" target="_blank" rel="noopener"><i class='fa fa-camera'></i> Showcases</a></li>
                <li class="" role=""><a href="/stop3DS/credits" target="_blank" rel="noopener"><i class='fa fa-bullhorn'></i> Credits</a></li>
        </section>
            <a id="clear-history" class="" href="#" data-clear-history-toggle=""><i class="fa  fa-history"></i> Clear History</a>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    
      
      
      
    <div id="top-github-link">
      <a class="github-link" href="https://github.com/vjeantet/hugo-theme-docdock/edit/master/exampleSite/content/discussions/applicationstate.md" target="blank">
        <i class="fa fa-code-fork"></i>
        Edit page
      </a>
    </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        







 <a href='/stop3DS/'></a> > <a href='/stop3DS/discussions/'>Discussions</a> > Application State

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#stop3ds-state">Stop3DS&rsquo; State</a>
<ul>
<li><a href="#top-level">Top level</a></li>
<li><a href="#user-input">User input</a></li>
<li><a href="#animation-state">Animation State</a>
<ul>
<li><a href="#state-mutability">State mutability</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Application State</h1>
  



    
    
    
    

<h2 id="overview">Overview</h2>

<p>Handling application state is an important and well discussed topic. Now I get to see what works well
for this application.</p>

<h2 id="stop3ds-state">Stop3DS&rsquo; State</h2>

<p>What does this application have to track on a high level? Things such as current animation, current
scene, current frame all seem like fair game. But why should knowledge of the current frame be anywhere
outside of the Animation construct? Why should it be outside of the current Scene construct? To explore
these questions let&rsquo;s break down the application.</p>

<h3 id="top-level">Top level</h3>

<p>Application Loop
User Input
Rendering
Animation state</p>

<p>The application loop and associated bits are what I would consider the &ldquo;top level&rdquo; of state hierarchy.
Everything else depends on the loop existing in the first place and any data being passed through it.</p>

<p>User input presents an interesting problem because it is important to abstract specific keycodes and
such from absolute events. Keeping things generic and flexible will help keep the code portable but also
much more maintainable.</p>

<p>Rendering the still frames is also an interesting case when it comes to state because there are many ways
that it is best to keep the rendering itself stateless and just have it functionally act on incoming data.</p>

<p>Animation state is an important one to figure out because that is a large part of how the user input is
going to interact with the application - starting/stopping, creating new frames/scenes/etc, touch input.
Having a good plan for how this will be handled will help keep everything else in check and simpler to
design.</p>

<p>I think it&rsquo;s important to distinguish between &ldquo;Rendering&rdquo; a frame and the user editing a frame. I believe
both should take on a functional aspect (in order to easily support undo/redo, etc) and also to consolidate
data and associated state. The rendering process has no need to handle user input, but editing frames certainly
does.</p>

<h3 id="user-input">User input</h3>

<p>I wonder if I could use a registration type setup for handling inputs. Each button would have a way to pass a
function that is called whenever it is pressed for instance. This is used in many other cases (like .onClick)
and would offer a way to dynamically alter a button&rsquo;s function without having a mess of state handling inside each
button&rsquo;s code. This would make contextual UI much simpler and something I could explore.</p>

<p>The question with this is if I can keep state from leaking from other places. I don&rsquo;t want the input code to somehow
become tied to the state of the current frame or something like that, but I think as long as I design the interface
correctly the chance of that is much less than some alternatives.</p>

<p>In pseudo code, maybe something akin to this may be useful:</p>

<pre><code>// Some accessible thing... where does this live?
InputManager inputman;

function doThingOne/Two/Three exist in local scope.
int foo = 10; // also exists here

// I need to read up on closures/scoping/lifetimes to appropriately
// alter local state and keep it contained.
inputman.registerButtonA(function(InputEvent event) {
		switch(event) {
			case BUTTON_DOWN:
				doThingOne();
				// Will this work like I expect?
				// (print 11)
				printf(&quot;My value: %d\n&quot;, foo+1);

			case BUTTON_HELD:
				doThingToThis(passedValue);

			case BUTTON_RELEASED:
				doThingThree();

			default:

		}
	});

</code></pre>

<p>Then whenever the application changed to a different mode the UI could be updated simply, eliminating</p>

<pre><code class="language-cpp">if (kDown &amp; BUTTON_A) {
	switch (currentMode) {
		case MODE_A:
			&lt;too much stuff&gt;
		case MODE_B:
			&lt;too much stuff&gt;
		case MODE_C:
			&lt;too much stuff&gt;
		case MODE_D:
			&lt;too much stuff&gt;
		case MODE_E:
			&lt;too much stuff&gt;
	}
}
</code></pre>

<p>or something akin to that. Being able to drop in arbitrary functions sounds interesting. There is a potential problem if two
things try to assign functionality at the same time (or expect their functionality to be active) but that sounds more like
a mistake rather than fundamental flaw.</p>

<h3 id="animation-state">Animation State</h3>

<p>I believe for my first attempt I am going to utilize a method I have used in other projects (notably the robotic platform my company created) wherein there lies a single mutable structure that defines the application&rsquo;s state and everything is derived from that central store. This is also the method used by Endgame in their functionally reactive UI (<a href="https://www.endgame.com/blog/technical-blog/how-we-built-our-ui">https://www.endgame.com/blog/technical-blog/how-we-built-our-ui</a>), so given previous success with this method I believe it is appropriate to give it a try here. The key to making this implementation work cleanly and remain maintainable is limiting mutability of the state. In essence, part A should not be able to directly change aspects of part B directly, even if it theoretically has vision of part B&rsquo;s components. It is also important to have things react as a function of the state, rather than have the state be part of the function. For instance, the following pseudo-snippet shows a basic comparison:</p>

<pre><code class="language-cpp">// Cleaner interaction
void drawFrame(Frame frm, Destination output) {
	/* Do my frame drawing routine */
	output = frm.source; // basic idea
}

// Potentially unclear and untestable
void drawFrame() {
	/* Do my frame drawing routine */
	// What is currentFrame/output and where did they come from?
	// This is brittle and tied to the state structure as it exists 
	// when the code was written.
	output = currentFrame.source;
}

</code></pre>

<p>In the first example we have context of all of the values being used thanks to the arguments passed, and we have an idea of what is going
on when we call the function - <code>drawFrame(currentFrame, bottomScreen)</code> is clear in its meaning over <code>drawFrame()</code>. Where is the frame being drawn in the second function? What frame is it? Having a function like the first eliminates situations where you would otherwise have <code>drawCurrentFrameOnTopScreen()</code> and <code>drawLastFrameOnBottomScreen()</code> or <code>drawCurrentFrameToBuffer()</code>.</p>

<p>That demonstrates how we can use the central state definition to <strong>derive</strong> presentation from the state, which is arguably a simpler problem than limiting the mutablility of the central state by different components. As stated above, this is an incredibly important design problem that makes or breaks this setup. So in this case I am going to limit state mutation to user inputs only.</p>

<h4 id="state-mutability">State mutability</h4>

<p>This application lives to react to user inputs. It is in many ways a dumb canvas, but even if it partakes in &ldquo;smart&rdquo; behaviors they are always a result of the user requesting them. As such, there should be no change to internal state outside of user input. Everything else that the system needs it should be able to derive from the results of these inputs.</p>


    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/stop3DS/discussions/advancedfeatures/" title="Advanced Features"> <i class="fa fa-chevron-left"></i></a>
    <a class="nav nav-next" href="/stop3DS/discussions/datastructure/" title="Data Structures" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/stop3DS/js/clipboard.min.js"></script>
<script src="/stop3DS/js/featherlight.min.js"></script>
<script src="/stop3DS/js/html5shiv-printshiv.min.js"></script>
<script src="/stop3DS/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/stop3DS/js/modernizr.custom.71422.js"></script>
<script src="/stop3DS/js/docdock.js"></script>
<script src="/stop3DS/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>